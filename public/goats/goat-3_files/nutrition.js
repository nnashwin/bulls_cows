!function(){var n=Handlebars.template,a=DDH.nutrition=DDH.nutrition||{};a.content=n(function(n,a,t,r,o){function e(n,a){var r,o,e="";return e+='\n    	<span class="nutrition__measurement">',(o=t.label)?r=o.call(n,{hash:{},data:a}):(o=n&&n.label,r=typeof o===d?o.call(n,{hash:{},data:a}):o),e+=f(r)+"</span>\n	"}function i(n,a){var r,o="";return o+='\n        <div class="nutrition__portion  frm__select">\n            <select class="nutrition__portion__dropdown">\n                ',r=t.each.call(n,n&&n.portions,{hash:{},inverse:_.noop,fn:_.program(4,l,a),data:a}),(r||0===r)&&(o+=r),o+="\n            </select>\n        </div>\n    "}function l(n,a){var r,o,e="";return e+='\n                    <option value="',(o=t.id)?r=o.call(n,{hash:{},data:a}):(o=n&&n.id,r=typeof o===d?o.call(n,{hash:{},data:a}):o),e+=f(r)+'">',(o=t.name)?r=o.call(n,{hash:{},data:a}):(o=n&&n.name,r=typeof o===d?o.call(n,{hash:{},data:a}):o),e+=f(r)+"</option>\n                "}function s(n,a){var r,o="";return o+="\n        ",r=t["if"].call(n,n&&n.currentPortion,{hash:{},inverse:_.noop,fn:_.program(7,c,a),data:a}),(r||0===r)&&(o+=r),o+="\n    "}function c(n){var a,t="";return t+='\n            <div class="nutrition__portion">'+f((a=n&&n.currentPortion,a=null==a||a===!1?a:a.name,typeof a===d?a.apply(n):a))+"</div>\n        "}this.compilerInfo=[4,">= 1.0.0"],t=this.merge(t,n.helpers),o=o||{};var p,h,u="",d="function",f=this.escapeExpression,_=this;return u+='<h1 class="nutrition__header  zci__header">\n    <span class="nutrition__amount">'+f((p=a&&a.currentPortion,p=null==p||p===!1?p:p.amount,typeof p===d?p.apply(a):p)),(h=t.uom)?p=h.call(a,{hash:{},data:o}):(h=a&&a.uom,p=typeof h===d?h.call(a,{hash:{},data:o}):h),u+=f(p)+"</span>\n	",p=t["if"].call(a,a&&a.label,{hash:{},inverse:_.noop,fn:_.program(1,e,o),data:o}),(p||0===p)&&(u+=p),u+='\n</h1>\n<div class="zci__content">\n    ',p=t["if"].call(a,a&&a.portions,{hash:{},inverse:_.program(6,s,o),fn:_.program(3,i,o),data:o}),(p||0===p)&&(u+=p),u+="\n</div>\n"})}();(function(env){"use strict";env.ddg_spice_nutrition=function(api_result){if(!api_result||!api_result.hits||!api_result.hits.length||api_result.max_score<1){return Spice.failed("nutrition")}var fieldToTerms={nf_calories:{terms:["calories","cals"],label:"Calories"},nf_calories_from_fat:{terms:["calories from fat","cals from fat","fat calories"],label:"Calories"},nf_total_fat:{terms:["fat"],uom:"g"},nf_saturated_fat:{terms:["saturated fat"],uom:"g"},nf_monounsaturated_fat:{terms:["monounsaturated fat"],uom:"g"},nf_polyunsaturated_fat:{terms:["polyunsaturated fat"],uom:"g"},nf_trans_fatty_acid:{terms:["trans fat","trans-fat","trans fatty acid"],uom:"g"},nf_cholesterol:{terms:["cholesterol"],uom:"mg"},nf_sodium:{terms:["sodium"],uom:"mg"},nf_total_carbohydrate:{terms:["carbohydrates","carbs"],uom:"g"},nf_dietary_fiber:{terms:["fiber","dietary fiber"],uom:"g"},nf_sugars:{terms:["sugar"],uom:"g"},nf_protein:{terms:["protein"],uom:"g"},nf_vitamin_a_dv:{terms:["vitamin a"],uom:"%",label:"Daily Value"},nf_vitamin_c_dv:{terms:["vitamin c"],uom:"%",label:"Daily Value"},nf_calcium_dv:{terms:["calcium"],uom:"%",label:"Daily Value"},nf_iron_dv:{terms:["iron"],uom:"%",label:"Daily Value"}},script=$('[src*="/js/spice/nutrition/"]')[0],source=$(script).attr("src"),matches=source.match(/nutrition\/([^\/]+)\/?(.*)/),foodItem=decodeURIComponent(matches[1]),stripRegex=/^(how|what)?('s | is | are | many | much )?(the )?(total | amount of )?/,getMeasurementInfo=function(searchTerm){var field,fieldInfo,term,i;var bestMatch={id:"nf_calories",label:"Calories",term:"cals",uom:undefined};for(field in fieldToTerms){fieldInfo=fieldToTerms[field];for(i=0;i<fieldInfo.terms.length;i++){term=fieldInfo.terms[i];if(searchTerm.match(term)&&(!bestMatch||bestMatch.term.length<term.length)){bestMatch={term:term,uom:fieldInfo.uom,label:fieldInfo.label,id:field}}}}return bestMatch},tmpTerm=DDG.get_query().toLowerCase().replace(stripRegex,""),measurementInfo=getMeasurementInfo(tmpTerm);if(!measurementInfo||!foodItem){return Spice.failed("nutrition")}var portions=[],boundToDropDown,$amount,$portion;for(var i=0;i<api_result.hits.length;i++){var item=api_result.hits[i].fields,regex=new RegExp(foodItem,"i");if(DDG.stringsRelevant(item.item_name,foodItem,[],3)&&regex.test(item.item_name)){if(portions.length){var splitPortionName=item.item_name.split(","),firstStr=splitPortionName[0];if(!regex.test(firstStr)){continue}}portions.push({id:portions.length,name:item.item_name,amount:item[measurementInfo.id]})}}if(!portions.length){return Spice.failed("nutrition")}Spice.add({id:"nutrition",name:"Nutrition",data:{uom:measurementInfo.uom,label:measurementInfo.label,portions:portions.length>1&&portions,currentPortion:portions[0]},meta:{sourceName:"Nutritionix",sourceUrl:"http://nutritionix.com/search?q="+foodItem},templates:{group:"base",options:{content:Spice.nutrition.content,moreAt:true}},onShow:function(){if(!boundToDropDown&&portions.length>1){var $el=Spice.getDOM("nutrition");$amount=$el.find(".nutrition__amount");$portion=$el.find(".nutrition__portion__dropdown");$portion.change(function(){var portionId=$portion.val();$amount.text(portions[portionId].amount+(measurementInfo.uom||""))});boundToDropDown=true}}})}})(this);